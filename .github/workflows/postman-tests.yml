name: Run API Tests

on:
  schedule:
    - cron: "0 0 * * *"  # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00 UTC
  workflow_dispatch:  # –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: üì• –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        uses: actions/checkout@v3

      - name: üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Newman –∏ Allure
        run: |
          npm install -g newman newman-reporter-allure
          echo "Newman –∏ Allure —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

      - name: üîç –ó–∞–ø—É—Å–∫ API-—Ç–µ—Å—Ç–æ–≤
        run: |
          newman run postman_collection_auth_fixed.json \
            --reporters cli,allure \
            --reporter-allure-export allure-results

      - name: üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ Allure
        run: |
          npm install -g allure-commandline
          allure generate allure-results --clean -o allure-report

      - name: üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á–µ—Ç–∞ –≤ GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./allure-report
